<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <title>Deteksi Tangan & Jari dan Wajah</title>
    <style>
        body {
            margin: 0;
            text-align: center;
            font-family: Arial, sans-serif;
            /* Background pakai gambar latar */
            background: url('images/latar.jpg') no-repeat center center fixed;
            background-size: cover;
        }

        h1 {
            color: white;
            margin: 20px;
            text-shadow: 2px 2px 5px black;
        }

        #canvas {
            border: 3px solid #fff;
            border-radius: 10px;
            margin-top: 10px;
            background: transparent;
        }

        #video {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Deteksi Tangan & Jari</h1>
    <video id="video" width="640" height="480" autoplay></video>
    <canvas id="canvas" width="640" height="480"></canvas>

    <!-- Tambahkan library AI -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/hand-pose-detection"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>

    <script>
        async function setup() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            // Akses kamera
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
            await video.play();

            // Load model MediaPipe Hands
            const model = await handPoseDetection.createDetector(
                handPoseDetection.SupportedModels.MediaPipeHands,
                {
                    runtime: 'mediapipe',
                    solutionPath: 'https://cdn.jsdelivr.net/npm/@mediapipe/hands',
                    modelType: 'lite',
                    maxHands: 1
                }
            );            

            const notes = {
                thumb: new Audio('sound/do.mp3'),
                index: new Audio('sound/re.mp3'),
                middle: new Audio('sound/mi.mp3'),
                ring: new Audio('sound/fa.mp3'),
                pinky: new Audio('sound/sol.mp3'),
                la: new Audio('sound/la.mp3'),
                si: new Audio('sound/si.mp3')
            };

            let fingerStates = {
                thumb: false,
                index: false,
                middle: false,
                ring: false,
                pinky: false,
                la: false,
                si: false
            };

            function isFingerUp(tip, pip) {
                return tip.y < pip.y;
            }

            function drawHand(keypoints) {
                const connections = [
                    [0, 1], [1, 2], [2, 3], [3, 4],
                    [0, 5], [5, 6], [6, 7], [7, 8],
                    [0, 9], [9, 10], [10, 11], [11, 12],
                    [0, 13], [13, 14], [14, 15], [15, 16],
                    [0, 17], [17, 18], [18, 19], [19, 20]
                ];

                document.addEventListener("keydown", (e) => {
                    if (e.key.toLowerCase() === "1") {
                        notes.la.currentTime = 0;
                        notes.la.play();
                    }
                    if (e.key.toLowerCase() === "s") {
                        notes.si.currentTime = 0;
                        notes.si.play();
                    }
                });

                ctx.strokeStyle = 'lime';
                ctx.lineWidth = 2;

                connections.forEach(([start, end]) => {
                    const p1 = keypoints[start];
                    const p2 = keypoints[end];
                    ctx.beginPath();
                    ctx.moveTo(p1.x, p1.y);
                    ctx.lineTo(p2.x, p2.y);
                    ctx.stroke();
                });

                keypoints.forEach(point => {
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 5, 0, 2 * Math.PI);
                    ctx.fillStyle = 'red';
                    ctx.fill();
                });
            }

            async function detect() {
                // Hanya gambar video (background diatur lewat CSS)
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                const hands = await model.estimateHands(video);

                if (hands.length > 0) {
                    const hand = hands[0];
                    drawHand(hand.keypoints);

                    const kp = hand.keypoints;
                    const fingers = {
                        thumb: isFingerUp(kp[4], kp[3]),
                        index: isFingerUp(kp[8], kp[6]),
                        middle: isFingerUp(kp[12], kp[10]),
                        ring: isFingerUp(kp[16], kp[14]),
                        pinky: isFingerUp(kp[20], kp[18])
                    };

                    for (const finger in fingers) {
                        if (fingers[finger] && !fingerStates[finger]) {
                            notes[finger].currentTime = 0;
                            notes[finger].play();
                            fingerStates[finger] = true;
                        } else if (!fingers[finger]) {
                            fingerStates[finger] = false;
                        }
                    }
                }

                requestAnimationFrame(detect);
            }

            detect();
        }

        // Mulai saat halaman selesai dimuat
        window.onload = setup;
    </script>
</body>
</html>
